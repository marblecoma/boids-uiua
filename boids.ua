# Experimental!
I ~ "git: github.com/Marcos-cat/iris"
Width    â† 1600
Height   â† 900
BoidSize â† 5

NumBoids      â† 500
Vel           â† 75
VelLimit      â† Ã— 2 Vel
Perception    â† 40
SeparationStr â† 0.6
AlignmentStr  â† 0.5
CohesionStr   â† 0.4
ChaseStr      â† 0.01

# Outputs new velocities steering away from boids within Perception radius
# Vel Strs ? PercMat Pos Vel Strs
Separation â† (
  âŠ™Ë™âŠ-     # calc position differences between all boids
  Ã—        # zero out position differences where distance is greater than perception
  Â±/+      # calc normalized separation vectors per boid
  Ã— âŠ¡â‚€â¤™âŠ™âŠ™âˆ˜ # scale vectors
  +        # add steering vectors to current velocities
)

# Outputs new velocities steering towards avg velocity of boids within Perception radius
# Vel Strs ? PercMat Pos Vel Strs
Alignment â† (
  ğ„âŠ¸Ã—      # zero out velocity differences where distance is greater than perception
  Ã·âˆ©/+Â±âŠ¸âŒµ  # calc average velocity of boids within Perception radius per boid
  âŠ¸-       # difference between current vel and avg vel per boid
  Ã— âŠ¡â‚â¤™âŠ™âŠ™âˆ˜ # scale differences
  -        # subtract differences from current velocities
)

# Outputs new velocities steering towards the average position of boids within Perception radius
# Vel Strs ? PercMat Pos Vel Strs
Cohesion â† (
  âŠ¸Ã—       # fill each col with positions of boids within Perception radius
  Ã·âˆ©/+Â±âŠ¸âŒµ  # calc average position of boids within Perception radius per boid
  Â±-       # calc normalized vectors pointing at avg position per boid
  Ã— âŠ¡â‚‚â¤™âŠ™âŠ™âˆ˜ # scale vectors
  -        # subtract cohesion vectors from current velocities
)

# Outputs positions and new velocities steering towards target
# Pos Vel ? Target Pos Vel
Chase â† (
  â¤™-             # steering vectors from current positions to target pos
  âŠ™(- Ã—ChaseStr) # subtract scaled steering vectors from current velocities
)

# Handles wrapping boids around screen edges
# Pos ? Pos
Wrap â† âœÂ°â„‚(âˆ©â—¿WidthâŸœHeight)

# Outputs new positions by adding current velocities and handling screen wrap
# Pos ? Pos Vel
Update â† (
  âŠ™(Ã—I~DtâœâŒµ(â†¥ Vel â†§ VelLimit)) # cap velocities between Vel and VelLimit and mul by delta time
  +                            # update positions
  Wrap                         # handle screen wrap
)

I~Open â„‚ Width Height "Boids"

# Generates random Pos and 2D Vel per boid
# Pos Vel ?
Reset â† (
  Ã—Vel â„‚ Â°âˆ Ã—Ï„ âˆµâ‹…âš‚ âŠš NumBoids
  âŒŠâ„‚ âˆ©Ã— WidthâŸœHeight âˆ©âˆµâ‹…âš‚ .âŠš NumBoids
)

Â°I~Screen~FPS 60
[SeparationStr AlignmentStr CohesionStr]
Reset

I~Loop!(
  I~Draw~Background Black
  I~Draw~Text White 50 â„‚ 10 -50 Height "Ctrl-r to Restart"
  âŠƒâ‹…âŠ™âˆ˜(+âŠ™â‹…â‹…âˆ˜) Ã—0.1 â‰¡/- I~Key~Pressed ["sw" "ad" "qe"]
  I~Draw~Text White 25 â„‚ 10 -150 Height âŠ‚"Separation (W/S): " Â°â‹•â…â‚âŠ¡â‚€â¤™âŠ™âŠ™âˆ˜
  I~Draw~Text White 25 â„‚ 10 -120 Height âŠ‚"Alignment (A/D): " Â°â‹•â…â‚âŠ¡â‚â¤™âŠ™âŠ™âˆ˜
  I~Draw~Text White 25 â„‚ 10 -90 Height âŠ‚"Cohesion (Q/E): " Â°â‹•â…â‚âŠ¡â‚‚â¤™âŠ™âŠ™âˆ˜
  â¥â‹…â‹…Reset /Ã— I~Key~Down {I~Key~LeftControl @R}
  I~Mouse!Downâ€¼Left Chase
  â‰¤Perception âŒµ âŠ¸Ë™âŠ-                  # Put perception matrix above positions and velocities on the stack
  â—Œ âŸœâ‚‚(Cohesion|Alignment|Separation) # Apply rules and then pop perception matrix
  âŠ¸Update
  âŠ¸I~Draw~Centered~Square White BoidSize
)
